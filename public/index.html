<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>‚öîÔ∏è Medieval Battle Arena</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=MedievalSharp&family=Cinzel:wght@400;700;900&display=swap');
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'MedievalSharp', serif;
      background: linear-gradient(135deg, #1a0f0a 0%, #3d2817 50%, #1a0f0a 100%);
      color: #f4e4c1;
      overflow: hidden;
    }
    
    /* Pixelated/crisp rendering for canvas */
    canvas {
      image-rendering: -moz-crisp-edges;
      image-rendering: -webkit-crisp-edges;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }
    
    #character-select {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, rgba(26,15,10,0.95) 0%, rgba(61,40,23,0.95) 100%);
      z-index: 1000;
      backdrop-filter: blur(10px);
    }
    
    #select-panel {
      background: linear-gradient(145deg, rgba(92,64,51,0.95), rgba(61,40,23,0.95));
      padding: 50px;
      border-radius: 10px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.9), inset 0 0 40px rgba(139,69,19,0.3);
      border: 4px solid #8b4513;
      border-image: linear-gradient(45deg, #cd7f32, #daa520, #cd7f32) 1;
      text-align: center;
      max-width: 800px;
    }
    
    h1 {
      font-family: 'Cinzel', serif;
      font-size: 48px;
      background: linear-gradient(135deg, #daa520 0%, #cd7f32 50%, #b8860b 100%);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 20px;
      letter-spacing: 4px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
      filter: drop-shadow(0 0 10px rgba(218,165,32,0.5));
    }
    
    #name-input {
      width: 100%;
      padding: 15px 20px;
      margin-bottom: 30px;
      background: rgba(61,40,23,0.7);
      border: 3px solid #8b4513;
      border-radius: 5px;
      color: #f4e4c1;
      font-size: 18px;
      font-family: 'MedievalSharp', serif;
      outline: none;
    }
    
    #name-input:focus {
      border-color: #daa520;
      box-shadow: 0 0 20px rgba(218,165,32,0.5);
    }
    
    .character-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .character-card {
      background: rgba(61,40,23,0.6);
      border: 3px solid #8b4513;
      border-radius: 8px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: inset 0 0 20px rgba(139,69,19,0.3);
    }
    
    .character-card:hover {
      border-color: #daa520;
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(218,165,32,0.4);
    }
    
    .character-card.selected {
      border-color: #daa520;
      background: rgba(218,165,32,0.25);
      box-shadow: 0 0 30px rgba(218,165,32,0.5);
    }
    
    .character-card h3 {
      font-family: 'Cinzel', serif;
      font-size: 24px;
      margin-bottom: 10px;
      color: #daa520;
    }
    
    .character-preview {
      width: 150px;
      height: 150px;
      margin: 0 auto 10px;
      background: rgba(26,15,10,0.5);
      border: 2px solid #8b4513;
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
    }
    
    #start-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #daa520 0%, #cd7f32 100%);
      border: 3px solid #8b4513;
      border-radius: 8px;
      color: #1a0f0a;
      font-size: 24px;
      font-weight: 900;
      font-family: 'Cinzel', serif;
      cursor: pointer;
      letter-spacing: 3px;
      transition: all 0.3s;
      text-shadow: 1px 1px 2px rgba(255,255,255,0.3);
    }
    
    #start-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(218,165,32,0.6);
    }
    
    #start-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    #start-btn.loading {
      opacity: 1;
      background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%);
      cursor: wait;
      position: relative;
    }
    
    .loading-spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #daa520;
      border-top: 2px solid transparent;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 10px;
      vertical-align: middle;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    #game-container {
      display: none;
      width: 100vw;
      height: 100vh;
    }
    
    #hud {
      position: fixed;
      top: 20px;
      left: 20px;
      right: 20px;
      display: flex;
      justify-content: space-between;
      z-index: 100;
      pointer-events: none;
    }
    
    .hud-panel {
      background: rgba(61,40,23,0.9);
      padding: 15px 20px;
      border-radius: 5px;
      border: 2px solid #8b4513;
      backdrop-filter: blur(10px);
      box-shadow: inset 0 0 15px rgba(139,69,19,0.4);
    }
    
    .hp-bar-container {
      width: 200px;
      height: 20px;
      background: rgba(0,0,0,0.5);
      border-radius: 10px;
      overflow: hidden;
      margin-top: 5px;
    }
    
    .hp-bar {
      height: 100%;
      background: linear-gradient(90deg, #8b0000 0%, #dc143c 100%);
      transition: width 0.3s;
    }
    
    #death-screen {
      position: fixed;
      inset: 0;
      display: none;
      pointer-events: none;
      align-items: flex-start;
      justify-content: center;
      padding-top: 15vh;
      background: rgba(0,0,0,0.6);
      z-index: 999;
    }
    
    #death-panel {
      background: linear-gradient(145deg, rgba(61,40,23,0.9), rgba(26,15,10,0.9));
      padding: 25px 35px;
      pointer-events: all;
      border-radius: 8px;
      border: 3px solid #8b0000;
      text-align: center;
      box-shadow: 0 0 30px rgba(139,0,0,0.7), inset 0 0 20px rgba(139,0,0,0.3);
    }
    
    #death-panel h2 {
      font-family: 'Cinzel', serif;
      font-size: 32px;
      color: #dc143c;
      margin: 0 0 10px 0;
      margin-bottom: 20px;
      text-shadow: 0 0 20px rgba(220,20,60,0.9);
    }
    
    #respawn-timer {
      font-family: 'MedievalSharp', serif;
      font-size: 24px;
      color: #f4a460;
      margin-top: 20px;
    }
    
    /* Leaderboard */
    #leaderboard {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(61,40,23,0.95);
      padding: 15px;
      border-radius: 5px;
      border: 2px solid #8b4513;
      min-width: 200px;
      max-height: 300px;
      overflow-y: hidden; /* No scroll */
      backdrop-filter: blur(10px);
      box-shadow: inset 0 0 15px rgba(139,69,19,0.4);
      z-index: 100;
    }
    
    #leaderboard h3 {
      font-family: 'Cinzel', serif;
      color: #daa520;
      margin-bottom: 10px;
      font-size: 18px;
      text-align: center;
    }
    
    .leaderboard-entry {
      padding: 5px;
      margin: 3px 0;
      background: rgba(26,15,10,0.5);
      border-radius: 3px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .leaderboard-entry.me {
      background: rgba(218,165,32,0.3);
      border: 1px solid #daa520;
    }
    
    .leaderboard-rank {
      font-weight: bold;
      color: #daa520;
      margin-right: 8px;
    }
    
    .leaderboard-name {
      flex: 1;
      color: #f4e4c1;
    }
    
    .leaderboard-kills {
      color: #dc143c;
      font-weight: bold;
    }
    
    /* Chat */
    #chat-container {
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 350px;
      background: rgba(61,40,23,0.95);
      border-radius: 5px;
      border: 2px solid #8b4513;
      backdrop-filter: blur(10px);
      box-shadow: inset 0 0 15px rgba(139,69,19,0.4);
      z-index: 100;
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
    }
    
    #chat-container.collapsed {
      height: 40px;
      overflow: hidden;
    }
    
    #chat-toggle {
      background: rgba(139,69,19,0.8);
      color: #daa520;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      font-family: 'MedievalSharp', serif;
      font-size: 14px;
      border-radius: 3px;
      margin: 5px;
    }
    
    #chat-toggle:hover {
      background: rgba(139,69,19,1);
    }
    
    #chat-messages {
      height: 200px;
      overflow-y: auto; /* Allow scroll for messages */
      padding: 10px;
      font-size: 18px;
    }
    
    .chat-message {
      margin-bottom: 8px;
      word-wrap: break-word;
    }
    
    .chat-message .chat-name {
      color: #daa520;
      font-weight: bold;
      font-size: 18px;
    }
    
    .chat-message .chat-text {
      color: #f4e4c1;
      font-size: 18px;
    }
    
    .kill-message {
      margin-bottom: 8px;
      font-size: 16px;
      font-weight: bold;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .chat-system {
      color: #8b8b8b;
      font-style: italic;
    }
    
    #chat-input-container {
      display: flex; /* Always visible */
      padding: 10px;
      border-top: 1px solid #8b4513;
    }
    
    #chat-input {
      flex: 1;
      background: rgba(26,15,10,0.7);
      border: 2px solid #8b4513;
      border-radius: 3px;
      color: #f4e4c1;
      padding: 8px;
      font-family: 'MedievalSharp', serif;
      font-size: 13px;
      outline: none;
    }
    
    #chat-input:focus {
      border-color: #daa520;
    }
    
    #chat-send {
      margin-left: 5px;
      background: #daa520;
      border: 2px solid #8b4513;
      border-radius: 3px;
      padding: 8px 15px;
      color: #1a0f0a;
      font-family: 'Cinzel', serif;
      font-weight: bold;
      cursor: pointer;
      pointer-events: all;
    }
    
    #chat-send:hover {
      background: #cd7f32;
    }
    
    /* Dev Mode */
    #dev-mode-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(61,40,23,0.9);
      border: 2px solid #8b4513;
      border-radius: 5px;
      padding: 10px 20px;
      color: #daa520;
      font-family: 'MedievalSharp', serif;
      font-size: 12px;
      cursor: pointer;
      pointer-events: all;
      z-index: 150;
      transition: all 0.3s;
    }
    
    #dev-mode-btn:hover {
      background: rgba(61,40,23,1);
      border-color: #daa520;
      transform: translateY(-2px);
    }
    
    #dev-panel {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 1200px;
      height: 80%;
      background: rgba(26,15,10,0.98);
      border: 3px solid #daa520;
      border-radius: 10px;
      z-index: 200;
      box-shadow: 0 0 50px rgba(0,0,0,0.9);
      flex-direction: column;
    }
    
    #dev-panel.active {
      display: flex;
    }
    
    #dev-header {
      background: rgba(61,40,23,0.9);
      padding: 15px 20px;
      border-bottom: 2px solid #8b4513;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    #dev-header h2 {
      margin: 0;
      color: #daa520;
      font-family: 'Cinzel', serif;
      font-size: 20px;
    }
    
    #dev-close {
      background: #dc143c;
      border: 2px solid #8b0000;
      border-radius: 3px;
      padding: 5px 15px;
      color: #fff;
      font-family: 'MedievalSharp', serif;
      cursor: pointer;
      pointer-events: all;
    }
    
    #dev-close:hover {
      background: #b00000;
    }
    
    #dev-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      color: #f4e4c1;
    }
    
    #dev-sidebar {
      background: rgba(61,40,23,0.5);
      padding: 15px;
      border-right: 2px solid #8b4513;
      min-width: 250px;
    }
    
    #dev-main {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    
    .dev-section {
      background: rgba(61,40,23,0.3);
      border: 2px solid #8b4513;
      border-radius: 5px;
      padding: 15px;
      margin-bottom: 15px;
    }
    
    .dev-section h3 {
      color: #daa520;
      font-family: 'Cinzel', serif;
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 16px;
    }
    
    .dev-control {
      margin-bottom: 10px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 5px;
    }
    
    .dev-control label {
      color: #f4e4c1;
      font-family: 'MedievalSharp', serif;
      font-size: 14px;
      min-width: 80px;
    }
    
    .dev-control input[type="number"] {
      background: rgba(26,15,10,0.7);
      border: 2px solid #8b4513;
      border-radius: 3px;
      color: #f4e4c1;
      padding: 5px;
      font-family: 'MedievalSharp', serif;
    }
    
    .dev-control select,
    .dev-control input[type="range"] {
      width: 100%;
      background: rgba(26,15,10,0.7);
      border: 2px solid #8b4513;
      border-radius: 3px;
      color: #f4e4c1;
      padding: 5px;
      font-family: 'MedievalSharp', serif;
    }
    
    .dev-control button {
      background: #daa520;
      border: 2px solid #8b4513;
      border-radius: 3px;
      padding: 8px 15px;
      color: #1a0f0a;
      font-family: 'MedievalSharp', serif;
      font-weight: bold;
      cursor: pointer;
      margin-right: 5px;
      margin-top: 5px;
    }
    
    .dev-control button:hover {
      background: #cd7f32;
    }
    
    #dev-canvas {
      background: #1a1a1a;
      border: 2px solid #8b4513;
      border-radius: 5px;
      display: block;
      margin: 10px auto;
    }
    
    .dev-info {
      font-size: 12px;
      color: #8b8b8b;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <!-- Character Selection Screen -->
  <div id="character-select">
    <div id="select-panel">
      <h1>‚öîÔ∏è MEDIEVAL BATTLE ARENA ‚öîÔ∏è</h1>
      <input id="name-input" type="text" placeholder="Enter thy warrior name" maxlength="20" autofocus />
      
      <div class="character-grid" style="grid-template-columns: 1fr; max-width: 400px; margin: 0 auto;">
        <div class="character-card" data-character="knight">
          <div class="character-preview">
            <img src="assets/player sprites/knight/idle/idle_r00_c00.png" style="width: 100px; height: 100px; object-fit: contain; image-rendering: pixelated;" alt="Knight">
          </div>
          <h3>KNIGHT</h3>
          <p>Noble warrior with sword and shield</p>
        </div>
      </div>
      
      <button id="start-btn" disabled>ENTER BATTLE</button>
    </div>
  </div>
  
  <!-- Death Screen -->
  <div id="death-screen">
    <div id="death-panel">
      <h2>‚ò†Ô∏è SLAIN ‚ò†Ô∏è</h2>
      <p style="font-size: 16px; color: #f4a460; font-family: 'MedievalSharp', serif; margin: 5px 0;">by <span id="killer-name">Unknown</span></p>
      <div id="respawn-timer" style="font-size: 14px; color: #daa520; margin: 12px 0;">Respawn in <span id="respawn-countdown">5</span>s</div>
      <button id="respawn-btn" style="
        padding: 10px 30px;
        font-size: 18px;
        font-family: 'Cinzel', serif;
        background: linear-gradient(145deg, #8b0000, #dc143c);
        color: #f4e4c1;
        border: 3px solid #daa520;
        border-radius: 5px;
        cursor: not-allowed;
        opacity: 0.5;
        transition: all 0.3s;
      " disabled>RESPAWN</button>
    </div>
  </div>
  
  <!-- Game Container -->
  <div id="game-container">
    <div id="hud">
      <div class="hud-panel">
        <div id="player-name">Player</div>
        <div class="hp-bar-container">
          <div class="hp-bar" id="hp-bar" style="width: 100%"></div>
        </div>
      </div>
      
      <div class="hud-panel">
        <div id="player-count">Players: 1</div>
      </div>
    </div>
    
    <!-- Leaderboard -->
    <div id="leaderboard">
      <h3>üèÜ LEADERBOARD üèÜ</h3>
      <div id="leaderboard-list"></div>
    </div>
    
    <!-- Chat -->
    <div id="chat-container">
      <button id="chat-toggle">‚ñº Chat</button>
      <div id="chat-messages"></div>
      <div id="chat-input-container">
        <input type="text" id="chat-input" placeholder="Press Enter to chat..." maxlength="200" />
        <button id="chat-send">Send</button>
      </div>
    </div>
    
    <canvas id="game-canvas"></canvas>
    
    <!-- Dev Mode Button -->
    <button id="dev-mode-btn">üîß Enter Dev Mode</button>
  </div>
  
  <!-- Dev Panel -->
  <div id="dev-panel">
    <div id="dev-header">
      <h2>‚öôÔ∏è Developer Tools - Hitbox Editor</h2>
      <button id="dev-close">Close</button>
    </div>
    <div id="dev-content" style="display: flex;">
      <div id="dev-sidebar">
        <div class="dev-section">
          <h3>Character & Animation</h3>
          <div class="dev-control">
            <label>Character:</label>
            <select id="dev-character-select">
              <option value="knight">Knight</option>
            </select>
          </div>
          <div class="dev-control">
            <label>Animation:</label>
            <select id="dev-animation-select">
              <option value="idle">Idle</option>
              <option value="walk">Walk (Run)</option>
              <option value="attack">Attack</option>
              <option value="shield">Shield</option>
              <option value="death_front">Death (Front)</option>
              <option value="death_behind">Death (Behind)</option>
              <option value="air">Air (Jump)</option>
              <option value="land">Land</option>
            </select>
          </div>
        </div>
        
        <div class="dev-section">
          <h3>Frame Control</h3>
          <div class="dev-control">
            <label id="dev-frame-display">Frame: 1 / 1</label>
            <button id="dev-prev-frame">‚Üê Previous</button>
            <button id="dev-next-frame">Next ‚Üí</button>
          </div>
          <div class="dev-control">
            <label>
              <input type="checkbox" id="dev-flip-sprite" /> Flip Sprite
            </label>
            <div class="dev-info">Facing: <span id="dev-facing-info">Left</span></div>
          </div>
          <div class="dev-control">
            <button id="dev-set-shield-frame" style="background: #3b82f6;">üõ°Ô∏è Set as Shield Frame</button>
            <div class="dev-info" style="font-size: 11px; color: #888; margin-top: 5px;">Current frame will freeze when holding S</div>
          </div>
        </div>
        
        <div class="dev-section">
          <h3>Sprite Settings</h3>
          <div class="dev-control">
            <label>Game Size:</label>
            <input type="range" id="dev-sprite-scale" min="0.1" max="5" step="0.1" value="1.0" style="flex: 1;" />
            <input type="number" id="dev-scale-input" min="0.1" max="5" step="0.1" value="1.0" style="width: 70px; margin-left: 10px;" />
            <div class="dev-info" style="font-size: 11px; color: #888; width: 100%; margin-top: 5px;">Actual size in game (0.1 = tiny, 5 = huge)</div>
          </div>
          <div class="dev-control">
            <label>Speed:</label>
            <input type="range" id="dev-speed-slider" min="0" max="10" step="0.5" value="5" style="flex: 1;" />
            <input type="number" id="dev-speed-input" min="0" max="10" step="0.5" value="5" style="width: 70px; margin-left: 10px;" />
            <div class="dev-info" style="font-size: 11px; color: #888; width: 100%; margin-top: 5px;">0 = No speed, 10 = Super fast</div>
          </div>
          <div class="dev-control">
            <label>Frame Time:</label>
            <input type="range" id="dev-frame-time" min="0.05" max="0.5" step="0.01" value="0.1" style="flex: 1;" />
            <input type="number" id="dev-frame-time-input" min="0.05" max="0.5" step="0.01" value="0.1" style="width: 70px; margin-left: 10px;" />
          </div>
        </div>
        
        <div class="dev-section">
          <h3>Hitbox Tools</h3>
          <div class="dev-control">
            <label style="margin-right: 10px;">
              <input type="radio" name="hitbox-scope" id="dev-scope-single" checked /> Single Frame
            </label>
            <label>
              <input type="radio" name="hitbox-scope" id="dev-scope-all" /> All Frames
            </label>
          </div>
          <div class="dev-control">
            <button id="dev-tool-body" style="background: #22c55e;">Body Hitbox</button>
            <button id="dev-tool-attack">Attack Hitbox</button>
            <button id="dev-tool-shield">Shield Hitbox</button>
          </div>
          <div class="dev-info" style="font-size: 11px; color: #888; margin-top: 5px;">
            Left-click drag: Create | Right-click: Delete
          </div>
          <div class="dev-control" id="dev-attack-controls" style="display: none;">
            <button id="dev-add-attack">+ Add Attack Hitbox</button>
            <div id="dev-attack-list"></div>
          </div>
          <div class="dev-control" id="dev-shield-controls" style="display: none;">
            <button id="dev-add-shield">+ Add Shield Hitbox</button>
            <div id="dev-shield-list"></div>
          </div>
        </div>
        
        <div class="dev-section">
          <h3>Frame Sounds</h3>
          <div class="dev-control">
            <button id="dev-add-sound" style="background: #3b82f6;">üîä Add Sound to Frame</button>
          </div>
          <div id="dev-sound-list" style="margin-top: 10px; max-height: 200px; overflow-y: auto;"></div>
        </div>
        
        <div class="dev-section">
          <h3>Save/Load</h3>
          <div class="dev-control">
            <button id="dev-save-btn" style="background: #22c55e;">üíæ Save</button>
            <button id="dev-reset-btn" style="background: #ef4444;">üîÑ Reset All</button>
          </div>
          <div id="dev-save-status" class="dev-info" style="background: #333; padding: 5px; border-radius: 3px; margin-top: 5px;">Ready</div>
          <div class="dev-info" style="font-size: 11px; color: #888; margin-top: 5px;">Saves hitboxes, size, speed, and all settings</div>
        </div>
      </div>
      
      <div id="dev-main">
        <div class="dev-section">
          <h3>Canvas (Draw hitboxes by clicking and dragging)</h3>
          <canvas id="dev-canvas" width="800" height="600"></canvas>
          <div class="dev-info" style="margin-top: 10px;">
            <strong>Body Hitbox:</strong> X: <span id="dev-body-x">-</span>, Y: <span id="dev-body-y">-</span>, 
            W: <span id="dev-body-w">-</span>, H: <span id="dev-body-h">-</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script src="/socket.io/socket.io.js"></script>
  <script src="game.js"></script>
</body>
</html>
